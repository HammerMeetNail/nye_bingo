openapi: 3.0.0
info:
  title: Year of Bingo API
  description: |
    Programmatic access to Year of Bingo cards.
    
    Authentication is performed via the `Authorization` header using Bearer tokens.
    Tokens can be generated in your profile settings.
    
    Example: `Authorization: Bearer yob_abc123...`

    Note: Some endpoints (e.g. AI generation) require an authenticated browser session cookie and do not accept API tokens.
  version: 1.7.1
servers:
  - url: /api
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: Opaque Token
    cookieAuth:
      type: apiKey
      in: cookie
      name: session_token
  schemas:
    BingoCard:
      type: object
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        year:
          type: integer
        title:
          type: string
          nullable: true
        category:
          type: string
          nullable: true
        grid_size:
          type: integer
          description: Square grid size (2-5)
          enum: [2, 3, 4, 5]
        header_text:
          type: string
          description: Header text rendered as one character per column
        has_free_space:
          type: boolean
        free_space_position:
          type: integer
          nullable: true
          description: Reserved FREE cell position in 0..(grid_size^2-1) when enabled
        is_active:
          type: boolean
        is_finalized:
          type: boolean
        visible_to_friends:
          type: boolean
        is_archived:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        items:
          type: array
          items:
            $ref: '#/components/schemas/BingoItem'
    BingoItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
        card_id:
          type: string
          format: uuid
        position:
          type: integer
          description: 0..(grid_size^2-1); FREE position is reserved when enabled
        content:
          type: string
        is_completed:
          type: boolean
        completed_at:
          type: string
          format: date-time
          nullable: true
        notes:
          type: string
          nullable: true
        proof_url:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
    PublicBingoCard:
      type: object
      properties:
        id:
          type: string
          format: uuid
        year:
          type: integer
        title:
          type: string
          nullable: true
        category:
          type: string
          nullable: true
        grid_size:
          type: integer
          description: Square grid size (2-5)
          enum: [2, 3, 4, 5]
        header_text:
          type: string
        has_free_space:
          type: boolean
        free_space_position:
          type: integer
          nullable: true
        is_finalized:
          type: boolean
    PublicBingoItem:
      type: object
      properties:
        position:
          type: integer
        content:
          type: string
        is_completed:
          type: boolean
    SharedCard:
      type: object
      properties:
        card:
          $ref: '#/components/schemas/PublicBingoCard'
        items:
          type: array
          items:
            $ref: '#/components/schemas/PublicBingoItem'
    CardShareStatus:
      type: object
      properties:
        enabled:
          type: boolean
        expired:
          type: boolean
        url:
          type: string
          description: Share token used to build the share URL (/s/{token}; legacy /#share/{token})
        created_at:
          type: string
          format: date-time
        expires_at:
          type: string
          format: date-time
          nullable: true
        last_accessed_at:
          type: string
          format: date-time
          nullable: true
        access_count:
          type: integer
        message:
          type: string
    CardStats:
      type: object
      properties:
        card_id:
          type: string
          format: uuid
        year:
          type: integer
        total_items:
          type: integer
        completed_items:
          type: integer
        completion_rate:
          type: number
        bingos_achieved:
          type: integer
        first_completion:
          type: string
          format: date-time
          nullable: true
        last_completion:
          type: string
          format: date-time
          nullable: true
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        username:
          type: string
        email:
          type: string
        email_verified:
          type: boolean
        email_verified_at:
          type: string
          format: date-time
          nullable: true
        ai_free_generations_used:
          type: integer
        searchable:
          type: boolean
    AccountDeleteRequest:
      type: object
      required:
        - confirm_username
        - password
        - confirm
      properties:
        confirm_username:
          type: string
        password:
          type: string
        confirm:
          type: boolean
    AccountMessage:
      type: object
      properties:
        message:
          type: string
    BlockedUser:
      type: object
      properties:
        id:
          type: string
          format: uuid
        username:
          type: string
        blocked_at:
          type: string
          format: date-time
    FriendInvite:
      type: object
      properties:
        id:
          type: string
          format: uuid
        inviter_user_id:
          type: string
          format: uuid
        expires_at:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
    Notification:
      type: object
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        type:
          type: string
          enum: [friend_request_received, friend_request_accepted, friend_bingo, friend_new_card]
        actor_user_id:
          type: string
          format: uuid
          nullable: true
        actor_username:
          type: string
          nullable: true
        friendship_id:
          type: string
          format: uuid
          nullable: true
        card_id:
          type: string
          format: uuid
          nullable: true
        card_title:
          type: string
          nullable: true
        card_year:
          type: integer
          nullable: true
        bingo_count:
          type: integer
          nullable: true
        in_app_delivered:
          type: boolean
        email_delivered:
          type: boolean
        email_sent_at:
          type: string
          format: date-time
          nullable: true
        read_at:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
    NotificationSettings:
      type: object
      properties:
        user_id:
          type: string
          format: uuid
        in_app_enabled:
          type: boolean
        in_app_friend_request_received:
          type: boolean
        in_app_friend_request_accepted:
          type: boolean
        in_app_friend_bingo:
          type: boolean
        in_app_friend_new_card:
          type: boolean
        email_enabled:
          type: boolean
        email_friend_request_received:
          type: boolean
        email_friend_request_accepted:
          type: boolean
        email_friend_bingo:
          type: boolean
        email_friend_new_card:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    ReminderSettings:
      type: object
      properties:
        user_id:
          type: string
          format: uuid
        email_enabled:
          type: boolean
        daily_email_cap:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    CardCheckinReminder:
      type: object
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        card_id:
          type: string
          format: uuid
        enabled:
          type: boolean
        frequency:
          type: string
        schedule:
          type: object
          additionalProperties: true
        include_image:
          type: boolean
        include_recommendations:
          type: boolean
        next_send_at:
          type: string
          format: date-time
          nullable: true
        last_sent_at:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    CardCheckinSummary:
      type: object
      properties:
        card_id:
          type: string
          format: uuid
        card_title:
          type: string
          nullable: true
        card_year:
          type: integer
        is_finalized:
          type: boolean
        is_archived:
          type: boolean
        has_free_space:
          type: boolean
        grid_size:
          type: integer
        checkin:
          $ref: '#/components/schemas/CardCheckinReminder'
          nullable: true
    GoalReminder:
      type: object
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        card_id:
          type: string
          format: uuid
        item_id:
          type: string
          format: uuid
        enabled:
          type: boolean
        kind:
          type: string
        schedule:
          type: object
          additionalProperties: true
        next_send_at:
          type: string
          format: date-time
          nullable: true
        last_sent_at:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    GoalReminderSummary:
      type: object
      properties:
        id:
          type: string
          format: uuid
        card_id:
          type: string
          format: uuid
        item_id:
          type: string
          format: uuid
        kind:
          type: string
        schedule:
          type: object
          additionalProperties: true
        next_send_at:
          type: string
          format: date-time
          nullable: true
        last_sent_at:
          type: string
          format: date-time
          nullable: true
        card_title:
          type: string
          nullable: true
        card_year:
          type: integer
        item_text:
          type: string
security:
  - bearerAuth: []
paths:
  /auth/me:
    get:
      summary: Get current user info
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Current user
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
  /account/export:
    get:
      summary: Export account data as ZIP
      security:
        - cookieAuth: []
      responses:
        '200':
          description: ZIP archive of account data
          content:
            application/zip:
              schema:
                type: string
                format: binary
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '403':
          description: Token authentication not allowed
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  /account:
    delete:
      summary: Delete account
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AccountDeleteRequest'
      responses:
        '200':
          description: Account deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccountMessage'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '403':
          description: Token authentication not allowed
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  /blocks:
    get:
      summary: List blocked users
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Blocked users
          content:
            application/json:
              schema:
                type: object
                properties:
                  blocked:
                    type: array
                    items:
                      $ref: '#/components/schemas/BlockedUser'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
    post:
      summary: Block a user
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user_id:
                  type: string
                  format: uuid
      responses:
        '201':
          description: User blocked
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '404':
          description: User not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '409':
          description: User already blocked
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  /blocks/{id}:
    delete:
      summary: Unblock a user
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: User unblocked
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '404':
          description: Block not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  /friends/invites:
    get:
      summary: List active friend invites
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Invites
          content:
            application/json:
              schema:
                type: object
                properties:
                  invites:
                    type: array
                    items:
                      $ref: '#/components/schemas/FriendInvite'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
    post:
      summary: Create a friend invite
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                expires_in_days:
                  type: integer
                  minimum: 1
                  maximum: 365
      responses:
        '201':
          description: Invite created
          content:
            application/json:
              schema:
                type: object
                properties:
                  invite:
                    $ref: '#/components/schemas/FriendInvite'
                  url:
                    type: string
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '409':
          description: Invite limit reached
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  /friends/invites/{id}/revoke:
    delete:
      summary: Revoke a friend invite
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Invite revoked
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '404':
          description: Invite not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  /friends/invites/accept:
    post:
      summary: Accept a friend invite
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                token:
                  type: string
      responses:
        '200':
          description: Invite accepted
          content:
            application/json:
              schema:
                type: object
                properties:
                  inviter:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                      username:
                        type: string
                  message:
                    type: string
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '403':
          description: Invite blocked
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '404':
          description: Invite not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '409':
          description: Already friends
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  /notifications:
    get:
      summary: List notifications
      security:
        - cookieAuth: []
      parameters:
        - in: query
          name: unread
          schema:
            type: string
          description: Set to 1 to return only unread notifications
        - in: query
          name: limit
          schema:
            type: integer
            default: 50
        - in: query
          name: before
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: Notification list
          content:
            application/json:
              schema:
                type: object
                properties:
                  notifications:
                    type: array
                    items:
                      $ref: '#/components/schemas/Notification'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
    delete:
      summary: Delete all notifications
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Notifications deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  /notifications/{id}:
    delete:
      summary: Delete notification
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Notification deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '400':
          description: Invalid notification ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '404':
          description: Notification not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  /notifications/{id}/read:
    post:
      summary: Mark notification as read
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Notification marked read
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '400':
          description: Invalid notification ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '404':
          description: Notification not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  /notifications/read-all:
    post:
      summary: Mark all notifications as read
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Notifications marked read
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  /notifications/unread-count:
    get:
      summary: Get unread notification count
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Unread count
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: integer
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  /notifications/settings:
    get:
      summary: Get notification settings
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Notification settings
          content:
            application/json:
              schema:
                type: object
                properties:
                  settings:
                    $ref: '#/components/schemas/NotificationSettings'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
    put:
      summary: Update notification settings
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                in_app_enabled:
                  type: boolean
                in_app_friend_request_received:
                  type: boolean
                in_app_friend_request_accepted:
                  type: boolean
                in_app_friend_bingo:
                  type: boolean
                in_app_friend_new_card:
                  type: boolean
                email_enabled:
                  type: boolean
                email_friend_request_received:
                  type: boolean
                email_friend_request_accepted:
                  type: boolean
                email_friend_bingo:
                  type: boolean
                email_friend_new_card:
                  type: boolean
      responses:
        '200':
          description: Updated notification settings
          content:
            application/json:
              schema:
                type: object
                properties:
                  settings:
                    $ref: '#/components/schemas/NotificationSettings'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '403':
          description: Email verification required for email notifications
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  /reminders/settings:
    get:
      summary: Get reminder settings
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Reminder settings
          content:
            application/json:
              schema:
                type: object
                properties:
                  settings:
                    $ref: '#/components/schemas/ReminderSettings'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
    put:
      summary: Update reminder settings
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email_enabled:
                  type: boolean
      responses:
        '200':
          description: Updated reminder settings
          content:
            application/json:
              schema:
                type: object
                properties:
                  settings:
                    $ref: '#/components/schemas/ReminderSettings'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '403':
          description: Email verification required for reminder emails
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  /reminders/cards:
    get:
      summary: List card check-in reminders
      security:
        - cookieAuth: []
      responses:
        '200':
          description: List of card reminders
          content:
            application/json:
              schema:
                type: object
                properties:
                  cards:
                    type: array
                    items:
                      $ref: '#/components/schemas/CardCheckinSummary'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  /reminders/cards/{cardId}:
    put:
      summary: Upsert a card check-in reminder
      security:
        - cookieAuth: []
      parameters:
        - name: cardId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                frequency:
                  type: string
                  enum: [monthly]
                schedule:
                  type: object
                  properties:
                    day_of_month:
                      type: integer
                    time:
                      type: string
                include_image:
                  type: boolean
                include_recommendations:
                  type: boolean
      responses:
        '200':
          description: Updated card reminder
          content:
            application/json:
              schema:
                type: object
                properties:
                  checkin:
                    $ref: '#/components/schemas/CardCheckinReminder'
        '400':
          description: Invalid reminder schedule
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '404':
          description: Card not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
    delete:
      summary: Delete a card check-in reminder
      security:
        - cookieAuth: []
      parameters:
        - name: cardId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Reminder deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '404':
          description: Reminder not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  /reminders/goals:
    get:
      summary: List goal reminders
      security:
        - cookieAuth: []
      parameters:
        - name: card_id
          in: query
          required: false
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: List of goal reminders
          content:
            application/json:
              schema:
                type: object
                properties:
                  reminders:
                    type: array
                    items:
                      $ref: '#/components/schemas/GoalReminderSummary'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
    post:
      summary: Upsert a goal reminder
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                item_id:
                  type: string
                  format: uuid
                kind:
                  type: string
                  enum: [one_time]
                schedule:
                  type: object
                  properties:
                    send_at:
                      type: string
      responses:
        '200':
          description: Updated goal reminder
          content:
            application/json:
              schema:
                type: object
                properties:
                  reminder:
                    $ref: '#/components/schemas/GoalReminder'
        '400':
          description: Invalid reminder schedule
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '404':
          description: Goal not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  /reminders/goals/{id}:
    delete:
      summary: Delete a goal reminder
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Reminder deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '404':
          description: Reminder not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  /reminders/test:
    post:
      summary: Send a reminder test email
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                card_id:
                  type: string
                  format: uuid
      responses:
        '200':
          description: Test email sent
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '400':
          description: Reminders disabled
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '403':
          description: Email verification required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  /cards:
    get:
      summary: List all cards
      responses:
        '200':
          description: List of cards
          content:
            application/json:
              schema:
                type: object
                properties:
                  cards:
                    type: array
                    items:
                      $ref: '#/components/schemas/BingoCard'
    post:
      summary: Create a new card
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                year:
                  type: integer
                title:
                  type: string
                category:
                  type: string
                grid_size:
                  type: integer
                  enum: [2, 3, 4, 5]
                header_text:
                  type: string
                has_free_space:
                  type: boolean
      responses:
        '201':
          description: Card created
          content:
            application/json:
              schema:
                type: object
                properties:
                  card:
                    $ref: '#/components/schemas/BingoCard'
  /cards/{id}:
    get:
      summary: Get a specific card
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Card details
          content:
            application/json:
              schema:
                type: object
                properties:
                  card:
                    $ref: '#/components/schemas/BingoCard'
  /cards/{id}/stats:
    get:
      summary: Get card statistics
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Card stats
          content:
            application/json:
              schema:
                type: object
                properties:
                  stats:
                    $ref: '#/components/schemas/CardStats'
  /cards/{id}/items:
    post:
      summary: Add item to card
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - content
              properties:
                content:
                  type: string
                position:
                  type: integer
      responses:
        '201':
          description: Item added
          content:
            application/json:
              schema:
                type: object
                properties:
                  item:
                    $ref: '#/components/schemas/BingoItem'
  /cards/{id}/items/{pos}:
    put:
      summary: Update item content
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
        - in: path
          name: pos
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                content:
                  type: string
      responses:
        '200':
          description: Item updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  item:
                    $ref: '#/components/schemas/BingoItem'
    delete:
      summary: Remove item
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
        - in: path
          name: pos
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Item removed
  /cards/{id}/finalize:
    post:
      summary: Finalize card (lock layout)
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Card finalized
          content:
            application/json:
              schema:
                type: object
                properties:
                  card:
                    $ref: '#/components/schemas/BingoCard'
  /cards/{id}/share:
    get:
      summary: Get share status for a card
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Share status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CardShareStatus'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '403':
          description: Access denied
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '404':
          description: Card not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
    post:
      summary: Create or rotate a share link
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                expires_in_days:
                  type: integer
                  description: Optional expiration window in days (0 or omit for no expiration)
      responses:
        '201':
          description: Share link created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CardShareStatus'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '403':
          description: Access denied
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '404':
          description: Card not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
    delete:
      summary: Revoke a share link
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Share revoked
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CardShareStatus'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '403':
          description: Access denied
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '404':
          description: Card not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  /cards/{id}/config:
    put:
      summary: Update draft card config (header/FREE)
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                header_text:
                  type: string
                has_free_space:
                  type: boolean
      responses:
        '200':
          description: Card updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  card:
                    $ref: '#/components/schemas/BingoCard'
  /cards/{id}/clone:
    post:
      summary: Clone card into a new draft
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                year:
                  type: integer
                title:
                  type: string
                category:
                  type: string
                grid_size:
                  type: integer
                  enum: [2, 3, 4, 5]
                header_text:
                  type: string
                has_free_space:
                  type: boolean
                  description: When omitted, defaults to the source card's FREE-space setting
      responses:
        '201':
          description: Card cloned
          content:
            application/json:
              schema:
                type: object
                properties:
                  card:
                    $ref: '#/components/schemas/BingoCard'
                  message:
                    type: string
  /cards/{id}/items/{pos}/complete:
    put:
      summary: Mark item as complete
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
        - in: path
          name: pos
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                notes:
                  type: string
                proof_url:
                  type: string
      responses:
        '200':
          description: Item marked complete
          content:
            application/json:
              schema:
                type: object
                properties:
                  item:
                    $ref: '#/components/schemas/BingoItem'
  /cards/{id}/items/{pos}/uncomplete:
    put:
      summary: Mark item as incomplete
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
        - in: path
          name: pos
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Item marked incomplete
          content:
            application/json:
              schema:
                type: object
                properties:
                  item:
                    $ref: '#/components/schemas/BingoItem'
  /cards/{id}/items/{pos}/notes:
    put:
      summary: Update item notes
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
        - in: path
          name: pos
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                notes:
                  type: string
                proof_url:
                  type: string
      responses:
        '200':
          description: Notes updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  item:
                    $ref: '#/components/schemas/BingoItem'
  /share/{token}:
    get:
      summary: Get a shared card by token
      security: []
      parameters:
        - in: path
          name: token
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Shared card
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SharedCard'
        '404':
          description: Share link not found or expired
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  /s/{token}:
    get:
      summary: Share landing page (OpenGraph)
      description: Public HTML landing page used for link previews (OpenGraph/Twitter) and redirecting users to the SPA share view.
      security: []
      parameters:
        - in: path
          name: token
          required: true
          schema:
            type: string
      responses:
        '200':
          description: HTML page containing OpenGraph tags for the shared card
          content:
            text/html:
              schema:
                type: string
        '404':
          description: Share link not found or malformed
          content:
            text/html:
              schema:
                type: string
  /og/share/{token}.png:
    get:
      summary: Shared card OpenGraph image
      description: Public PNG image representing the shared card state (no notes).
      security: []
      parameters:
        - in: path
          name: token
          required: true
          schema:
            type: string
      responses:
        '200':
          description: PNG image
          content:
            image/png:
              schema:
                type: string
                format: binary
        '304':
          description: Not modified
        '404':
          description: Share link not found or malformed
  /suggestions:
    get:
      summary: Get random suggestions
      security: []
      responses:
        '200':
          description: List of suggestions
  /suggestions/categories:
    get:
      summary: Get suggestion categories
      security: []
      responses:
        '200':
          description: List of categories
  /ai/generate:
    post:
      summary: Generate AI goals
      description: |
        Generates suggested bingo goals (1-24) based on user inputs.

        This endpoint requires a browser session cookie (API tokens are not allowed).
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - category
                - difficulty
                - budget
              properties:
                category:
                  type: string
                  enum: [hobbies, health, career, social, travel, mix]
                focus:
                  type: string
                  maxLength: 100
                difficulty:
                  type: string
                  enum: [easy, medium, hard]
                budget:
                  type: string
                  enum: [free, low, medium, high]
                context:
                  type: string
                  maxLength: 500
                count:
                  type: integer
                  minimum: 1
                  maximum: 24
                  default: 24
      responses:
        '200':
          description: Generated goals
          content:
            application/json:
              schema:
                type: object
                properties:
                  goals:
                    type: array
                    items:
                      type: string
                  free_remaining:
                    type: integer
                    nullable: true
        '400':
          description: Invalid input or unsafe request
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  free_remaining:
                    type: integer
                    nullable: true
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '403':
          description: Email verification required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  free_remaining:
                    type: integer
        '429':
          description: Rate limited
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '503':
          description: AI provider unavailable
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  /ai/guide:
    post:
      summary: Generate AI guide goals
      description: |
        Generates 1-5 AI goal suggestions for refining or adding a goal.

        This endpoint requires a browser session cookie (API tokens are not allowed).
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - mode
              properties:
                mode:
                  type: string
                  enum: [refine, new]
                current_goal:
                  type: string
                  maxLength: 500
                  description: Required when mode is refine.
                hint:
                  type: string
                  maxLength: 500
                count:
                  type: integer
                  minimum: 1
                  maximum: 5
                  description: Defaults to 3 for refine and 5 for new.
                avoid:
                  type: array
                  maxItems: 24
                  items:
                    type: string
                    maxLength: 100
      responses:
        '200':
          description: Generated goals
          content:
            application/json:
              schema:
                type: object
                properties:
                  goals:
                    type: array
                    items:
                      type: string
                  free_remaining:
                    type: integer
                    nullable: true
        '400':
          description: Invalid input or unsafe request
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  free_remaining:
                    type: integer
                    nullable: true
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '403':
          description: Email verification required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  free_remaining:
                    type: integer
        '429':
          description: Rate limited
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '503':
          description: AI provider unavailable
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
